import{c as Z,j as e,S as ee,a as H,f as M,C as D,T as d,R as b,b as te,d as ne,N as se,_ as ie,B as oe,e as _,u as G,g as ae,D as le,h as C,i as O,k as ce,l as re,m as l,P as de,n as K,o as U,p as ue,q as N,t as k,r as xe,s as he,v,I as ge,w as pe,V as me,x as Se,y as Te,z as je,A as be,F as fe,E as Ie,G as ye,H as Re,J as we,K as Ce,L as q,M as Q,O as ve,Q as ke,U as Ae}from"./index-C4VLIlwz.js";function Pe({clusterTechnicalId:t,topicName:n,retentionTimeInSeconds:s}){return{apiVersion:"v1",kind:"IndexedTopic",metadata:{cluster:t,name:n},spec:{retentionTimeInSecond:s}}}function Le(t){return{apiVersion:"v1",kind:"IndexedTopic",metadata:{cluster:t.clusterSlug,name:t.topic},spec:{retentionTimeInSecond:t.retentionTimeInSeconds}}}const $={tableEnabled:!1,sorting:[],searchValue:"",page:1,retentionTimeStates:{},globalRetentionTime:"86400",rowSelection:{}},A=Z()((t,n)=>({...$,actions:{_setValue:(s,i)=>t({[s]:typeof i=="function"?i(n()[s]):i}),setTableEnabled:s=>t({tableEnabled:s}),setRowSelection:s=>n().actions._setValue("rowSelection",s),setSorting:s=>n().actions._setValue("sorting",s),setSearchValue:s=>t({searchValue:s}),setPage:s=>t({page:s}),getRowRetentionTime:s=>parseInt(n().retentionTimeStates[s]??n().globalRetentionTime),getTopicListFilters:()=>{const{searchValue:s}=n(),i=[{type:"HideInternal"},{type:"HideStream"}];return s&&i.push({type:"TopicNameFilter",contains:s}),i},setRetentionTime:({topicName:s,retentionTime:i})=>{t({retentionTimeStates:{...n().retentionTimeStates,[s]:i}})},setGlobalRetentionTime:s=>{const i=Object.keys(n().retentionTimeStates).reduce((o,a)=>(o[a]=s,o),{});t({retentionTimeStates:i,globalRetentionTime:s})},reset:()=>t($)}})),P=()=>A(t=>t.actions),L=()=>A(({actions:t,...n})=>n),Be=t=>A(n=>n.retentionTimeStates[t]??n.globalRetentionTime),Ee=165,F=[{value:"3600",label:"1 hour"},{value:"86400",label:"1 day"},{value:"604800",label:"1 week"},{value:"2678400",label:"1 month"}],B=({retentionTime:t,onValueChange:n,disabled:s})=>{const i=!F.find(o=>o.value===t);return e.jsxs(ee,{css:{width:Ee},name:"indexedRetentionTime",label:"Indexed Retention Time",hideLabel:!0,onValueChange:n,disabled:s,value:t,children:[F.map(o=>e.jsx(H,{value:o.value,children:o.label},o.value)),i&&e.jsx(H,{value:t,children:M(parseInt(t))})]})},j=_(),ze=[j.display({id:"checkbox",header:({table:t})=>e.jsx(D,{checked:t.getIsSomePageRowsSelected()?"indeterminate":t.getIsAllPageRowsSelected(),onCheckedChange:()=>t.toggleAllPageRowsSelected()}),cell:({row:t})=>e.jsx(D,{checked:t.getIsSelected(),disabled:!t.getCanSelect(),onCheckedChange:t.getToggleSelectedHandler()}),enableResizing:!1,size:30}),j.accessor("name",{id:"ByName",header:"Topics",cell:({getValue:t})=>e.jsx(d,{weight:"medium",children:t()}),enableSorting:!0}),j.accessor("recordCount",{id:"ByMessageCount",header:"Count",cell:({row:{original:t}})=>e.jsxs(b,{justify:"flex-start",gap:1,children:[t.cleanupPolicy!=="delete"&&"â‰ˆ",e.jsx(te,{children:ne(t.recordCount)})]}),enableSorting:!0}),j.accessor("topicSize",{header:"Topic Size",id:"ByTopicSizeByte",cell:t=>{const n=t.getValue();return se(n).with(0,()=>e.jsx(d,{children:n})).with(ie.union(void 0,null),()=>e.jsx(d,{children:"-"})).otherwise(s=>e.jsx(oe,{value:s}))},enableSorting:!0}),j.display({id:"indexedRetentionTime",header:"Indexed Retention Time",cell:function({row:{original:n}}){const s=Be(n.name),{tableEnabled:i}=L(),{setRetentionTime:o}=P();return e.jsx(B,{retentionTime:s,onValueChange:a=>o({topicName:n.name,retentionTime:a}),disabled:!i})},enableResizing:!1,size:190})],Ve=({closeSlideout:t})=>{const n=G(),{mutateAsync:s}=K(),{rowSelection:i}=L(),{getRowRetentionTime:o}=P(),{trackEvent:a}=U(),x=()=>{const g=Object.entries(i).filter(([,c])=>c).map(([c])=>s(Pe({clusterTechnicalId:n,topicName:c,retentionTimeInSeconds:o(c)}),{onSuccess:()=>{a("cdk.devtools.sql.topic.Added",{topicNameHash:N(c),isSuccess:!0})},onError:()=>{a("cdk.devtools.sql.topic.Added",{topicNameHash:N(c),isSuccess:!1})}}));Promise.allSettled(g).then(c=>{const m=c.filter(r=>r.status==="fulfilled"),p=c.filter(r=>r.status==="rejected");m.length>0&&k({title:`${m.length} topic${m.length>1?"s":""} have been scheduled for indexing`}),p.length>0&&xe({title:`${p.length} error${p.length>1?"s":""} encountered`,description:p.map(r=>{var S,f,I,y;return he(r.reason)?((f=(S=r.reason.response)==null?void 0:S.data)==null?void 0:f.msg)||((y=(I=r.reason.response)==null?void 0:I.data)==null?void 0:y.title)||r.reason.message:String(r.reason)}).join(`
`)}),t()})};return e.jsx(C,{disabled:Object.keys(i).length===0,onClick:x,children:"Add topics"})},He=({open:t,setOpen:n})=>{var z,V;const s=G(),{globalRetentionTime:i,page:o,sorting:a,tableEnabled:x,rowSelection:g}=L(),{setGlobalRetentionTime:c,getTopicListFilters:m,setSorting:p,setSearchValue:r,setPage:S,setTableEnabled:f,setRowSelection:I,reset:y}=P(),W=m(),E=10,{data:u,status:X}=ae({page:o,itemsPerPage:E,filter:W,descSort:((z=a[0])==null?void 0:z.desc)??!1,sort:((V=a[0])==null?void 0:V.id)??"ByName"},ue,s,({data:T,...J})=>({...J,data:T.filter(Y=>Y.type==="IndexedTopic")})),R=()=>{y(),n(!1)};return e.jsx(le,{forceOpen:t,onClose:R,onInteractOutside:R,title:"Index Topics",size:"large",horizontalPadding:"$4",footer:e.jsxs(b,{css:{"& button":{flexGrow:"unset"}},justify:"flex-end",gap:2,children:[e.jsx(C,{variant:"secondary",onClick:R,children:"Cancel"}),e.jsx(Ve,{closeSlideout:R})]}),children:e.jsxs(O,{gap:6,children:[e.jsx(ce,{title:"This feature is in beta and is subject to change as we enhance it further",description:e.jsxs(O,{align:"flex-start",fullWidth:!0,gap:2,children:[e.jsx(d,{children:"Index your Kafka topics so you can query them using SQL"}),e.jsx(C,{variant:"secondary",size:"small",onClick:()=>{f(!0)},children:"I acknowledge"})]}),type:"info",dismissible:x}),e.jsx(re,{css:{"&[inert]":{opacity:.5}},inert:x?void 0:"",children:e.jsxs(l.Root,{data:(u==null?void 0:u.data)??[],columns:ze,manualMode:!0,config:{autoResetPageIndex:!0,getRowId:T=>T.name,onSortingChange:p,onRowSelectionChange:I,pageCount:(u==null?void 0:u.totalPages)??1},state:{sorting:a,rowSelection:g},children:[e.jsxs(l.ActionBar,{borderless:!0,children:[e.jsx(l.ActionBarSearch,{manualFiltering:!0,onChange:T=>{r(T.target.value.trim())}}),e.jsxs(b,{css:{pr:"$4"},justify:"flex-start",gap:2,children:[e.jsx(de,{elementsCount:(u==null?void 0:u.totalElements)??0,pageSize:E,pageIndex:o-1,onPreviousClick:()=>{S(o-1)},onNextClick:()=>{S(o+1)}}),e.jsx(B,{retentionTime:i,onValueChange:c,disabled:!x})]})]}),e.jsxs(l.Container,{children:[e.jsx(l.Head,{}),e.jsx(l.Body,{isPlaceholder:X==="loading"})]})]})})]})})},h=_(),w="-",De=({setTopicToRemove:t})=>[h.accessor("topic",{header:"Topics",id:"topicName",cell:({getValue:n})=>e.jsx(d,{weight:"medium",children:n()}),enableSorting:!0}),h.accessor("topicTableName",{header:"Topic table name",id:"topicTableName",cell:({getValue:n})=>e.jsx(d,{mono:!0,children:n()??w}),enableHiding:!0,enableSorting:!0,size:600}),h.accessor("offsetLag",{header:"Offset lag",id:"offsetLag",cell:({getValue:n})=>e.jsx(d,{children:n()??w}),enableHiding:!0,enableSorting:!0,size:150}),h.accessor("timeLagInSeconds",{header:"Time lag",id:"timeLag",cell:({getValue:n})=>{const s=n();return e.jsx(d,{children:s?M(s):w})},enableHiding:!0,enableSorting:!0,size:150}),h.accessor("indexedCount",{header:"Indexed count",id:"indexedCount",cell:({getValue:n})=>e.jsx(d,{children:n()??w}),enableHiding:!0,enableSorting:!0,size:150}),h.accessor("retentionTimeInSeconds",{header:"Indexed retention time",id:"retentionTime",cell:function({getValue:s,row:i}){const[o,a]=v.useState(s().toString()),{mutate:x}=K();return e.jsx(B,{retentionTime:o,onValueChange:g=>{x(Le({...i.original,retentionTimeInSeconds:parseInt(g)}),{onSuccess:({resource:c})=>{k({title:`Indexed retention time successfully updated for ${c.metadata.name}`}),a(g)}})},disabled:!1})},enableHiding:!0}),h.display({id:"actions",header:"",cell:({row:n})=>e.jsx(ge,{icon:pe,size:"small",variant:"secondary",onClick:()=>t(n.original.topic),children:e.jsx(me,{children:"Delete indexed topic"})}),size:30,enableResizing:!1})],Oe=({topicName:t,onOpenChange:n})=>{const{mutate:s,isLoading:i}=Se();return e.jsx(Te,{open:!!t,onOpenChange:n,onClose:()=>n(!1),onRemove:()=>{t&&s(t,{onSuccess:()=>{k({title:`Indexed topic ${t} deleted successfully`}),n(!1)}})},isLoading:i,title:"Delete indexed topic",warning:"Deleting this indexed topic is permanent and irreversible.",description:"Please be aware that all of the data and settings associated with this indexed topic will be permanently deleted and cannot be retrieved.",resources:[{Icon:je,resourceName:t??"",resourceType:"indexed topic"}]})},Ne=({indexedTopics:t})=>{const[n,s]=v.useState(null),i=v.useMemo(()=>De({setTopicToRemove:s}),[]);return e.jsxs(e.Fragment,{children:[e.jsxs(l.Root,{data:t,columns:i,initialState:{columnPinning:{left:["topicName"],right:["actions"]}},children:[e.jsxs(l.ActionBarSticky,{watchData:t,children:[e.jsx(d,{as:"h2",type:"body-m",weight:"semi",children:"Results"}),e.jsxs(b,{gap:2,children:[e.jsx(l.ActionBarPagination,{}),e.jsxs(l.ActionBarSettings.Root,{children:[e.jsx(l.ActionBarSettings.ColumnVisibility,{}),e.jsx(l.ActionBarSettings.RowsPerPage,{})]})]})]}),e.jsxs(l.Container,{children:[e.jsx(l.Head,{}),e.jsx(l.Body,{})]})]}),e.jsx(Oe,{topicName:n,onOpenChange:o=>{o||s(null)}})]})},qe=be(fe,{flexDirection:"column",gap:"$5",pt:"$4",height:"100%"}),$e=()=>{const{data:t=[],isLoading:n}=Ie(),[s,i]=v.useState(!1),{trackPage:o}=U();ye(()=>{o("cdk.devtools.sql.Viewed",{})});const a=e.jsx(C,{leftIcon:Ae,onClick:()=>i(!0),children:"Add topic"});return e.jsxs(qe,{children:[e.jsxs(b,{children:[e.jsx(d,{as:"h1",type:"display-s",weight:"bold",children:"SQL"}),a]}),n?e.jsx(Re,{centeredX:!0,centeredY:!0,fullScreen:!0}):t.length>0?e.jsxs(we,{css:{flexGrow:1},defaultValue:"editor",children:[e.jsxs(Ce,{variant:"border",children:[e.jsx(q,{value:"editor",children:"Editor"}),e.jsx(q,{value:"indexed-topics",children:"Indexed Topics"})]}),e.jsx(Q,{value:"editor",css:{flexGrow:1},children:e.jsx(ve,{})}),e.jsx(Q,{value:"indexed-topics",children:e.jsx(Ne,{indexedTopics:t})})]}):e.jsx(ke,{title:"No indexed topics",description:"There are no indexed topics to display. Ensure you're connected to the right cluster with appropriate permissions or create a new topic.",illustrationName:"topics-list",create:a,docLink:"#"}),e.jsx(He,{open:s,setOpen:i})]})};export{$e as default};
